{% extends "field/base.html" %}
{% load i18n static customformatting %}

{% block container %}
  <div class="container">

    {% if worker.has_staff %}

      <div class="panel panel-primary">

        <div class="panel-heading">
          {% trans 'Manage' %}
        </div>

        <div class="list-group">
          <a href="{% url 'field.projects' %}" class="list-group-item">{% trans 'Projects' %} <span
              class="pull-right">&raquo;</span></a>
          <a href="{% url 'field.planning' %}" class="list-group-item">{% trans 'Planning' %} <span
              class="pull-right">&raquo;</span></a>
          <a href="{% url 'field.equipment' %}" class="list-group-item">{% trans 'Equipment' %} <span
              class="pull-right">&raquo;</span></a>
        </div>

      </div>

    {% endif %}

    <div class="day-separator">
      {% now "l" %}, {% now "DATE_FORMAT" %}
      {% if worker.is_laborer or worker.is_foreman %}
        <a href="{% url 'field.projects' %}"
           class="btn btn-default btn-contextual btn-add-plan">{% trans "Projects" %} &raquo;</a>
      {% endif %}
    </div>

    {% for plan in todays_plans %}

      <div class="day-separator">
        {{ plan.jobsite.project.name }}
      </div>

      {% include "field/dailyplan.html" with dailyplan=plan %}

    {% empty %}

      <p>{% trans "You have not been assigned to any job sites today." %}</p>

    {% endfor %}

    {% if worker.can_track_time %}
      {% include "timetracking/dashboard_part.html" %}
    {% endif %}

    {% if worker.is_timetracking_enabled %}
    <div class="panel panel-default">

      <div class="panel-heading">
        {% trans "Timesheet" %}
      </div>

      {% if timesheet %}
      <table class="table table-striped table-bordered">

        <thead>
        <tr>
          <th></th>
          <th>{% trans "Previous" context "timesheet" %}</th>
          <th>{{ timesheet.document_date|date:"F" }}</th>
          <th>{% trans "Balance" context "timesheet" %}</th>
        </tr>
        </thead>

        <tr>
          <td>{% trans "Holiday" %}</td>
          <td>{{ timesheet.json.holiday_transferred|todecimalhours }}</td>
          <td>{{ timesheet.json.holiday_added|todecimalhours }}{% if timesheet.json.holiday_total != 0 %}-{{ timesheet.json.holiday_total|todecimalhours }}{% endif %}</td>
          <td class="info">{{ timesheet.json.holiday_balance|todecimalhours }} ({{ timesheet.json.holiday_balance|workdays }})</td>
        </tr>

        <tr>
          <td>{% trans "Overtime" %}</td>
          <td>{{ timesheet.json.overtime_transferred|todecimalhours }}</td>
          <td>{{ timesheet.json.overtime_total|todecimalhours }}</td>
          <td class="info">{{ timesheet.json.overtime_balance|todecimalhours }} ({{ timesheet.json.overtime_balance|workdays }})</td>
        </tr>

      </table>
      {% else %}
        <div class="panel-body">
          <p>{% trans "No timesheets have been created yet." %}</p>
        </div>
      {% endif %}

      <div class="panel-footer clearfix">
        <div class="pull-right">
          <a href="{% url 'field.timers' %}" class="btn btn-primary">{% trans "Timers" %}</a>
        </div>
      </div>

    </div>
    {% endif %}

  </div>
{% endblock %}
