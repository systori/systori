{% extends "base.html" %}
{% load static i18n l10n customformatting timetracking %}

{% debug %}

{% block head %}
  {{ block.super }}
<style type="text/css">
  #progress {
    -webkit-transition: none !important;
    transition: none !important;
  }
  grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px,1fr));
    grid-auto-rows: min-content;
    grid-gap: 5px;
  }
  grid-child {
    display:flex;
    flex-direction:column;
  }
  project-id {
    align-self: center;
    font-weight: bold;
    width: 100%;
    text-align: center;
  }
  .project-id-info {
    background-color: #bce8f1;
  }
  .project-id-warning {
    background-color: #faebcc;
  }
  .project-id-primary {
    background-color: #bba892;
  }
  project-title {
    font-size: large;
    align-self: stretch;
    text-align: center;
    border-top: 1px solid #e3e3e3;
    padding-top: 5px;
    padding-bottom: 5px;
  }
  jobsite-address {
  }
  jobsite {
  }
  workers {
    display: flex;
    flex-direction: column;
  }
  equipment {
    display:flex;
    flex-direction: column;
  }
  notes {
  }

</style>
{% endblock %}

{% block header %}
  <div style="font-size:20px; height:100%; position:relative;">
  <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation" style="margin:0px;">
    <div class="container-fluid">

      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
                aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">{% trans 'Toggle navigation' %}</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/">Systori</a>
      </div>
      <div id="navbar" class="navbar-collapse collapse">

        <ul class="nav navbar-nav">
          <li><a href="{{ previous_day_url }}">{% trans 'back' %}</a></li>
          <li><a>{{ selected_day|date:"l" }} {{ selected_day|localize }}</a></li>
          <li><a href="{{ next_day_url }}">{% trans 'next' %}</a></li>
        </ul>
        <div class="nav navbar-text progress pull-right" style="width: 300px;">
            <div id="progress" role="progressbar" style="background-color: #d1725e; height:100%;"></div>
        </div>
      </div>
    </div>
  </nav>
{% endblock %}


{% block container %}
{% load_user_statuses %}
<div class="container-fluid">
  <grid>
    {% for plan in selected_plans %}
      <grid-child>
        <project-id class="{% if is_selected_past %}project-id-warning{% endif %}
        {% if is_selected_today %}project-id-primary{% endif %}
        {% if is_selected_future %}project-id-info{% endif %}" data-id="{{ plan.id|unlocalize }}">
        # {{ plan.jobsite.project.id }}</project-id>

        <project-title class="{% if is_selected_past %}project-id-warning{% endif %}
        {% if is_selected_today %}project-id-primary{% endif %}
        {% if is_selected_future %}project-id-info{% endif %}" data-id="{{ plan.id|unlocalize }}">
        {{ plan.jobsite.project.name }}</project-title>

        <jobsite>{{ plan.jobsite.name }}</jobsite>
        <jobsite-address>{{ plan.jobsite.address }} {{ plan.jobsite.city }}</jobsite-address>

        <workers>
            {% for plan_worker in plan.workers.all %}
              <span>{{ plan_worker.get_full_name }}</span>
            {% endfor %}
        </workers>
        <equipment>
        <span class="glyphicon glyphicon-wrench"></span>
              {% for equipment in plan.equipment.all %}
                <span>{{ equipment|safe }}</span>
              {% endfor %}
        </equipment>
        <notes>
          <span class="glyphicon glyphicon-paperclip"></span>
            {% if plan.notes %}
              {{ plan.notes }}
            {% endif %}
        </notes>
      </grid-child>
    {% endfor %}
  </grid>
</div>

{% endblock %}
{% block extra_js %}
  <script type="text/javascript">
  
  $(document).ready(function(){
    $('.equal-height-panels .panel').matchHeight();

    jQuery(".fit-text").fitText(1.3);

    $("#progress").animate({
       width: "0%"
    }, 15000, function() {
      //page_reload();
      }
    );
  
  });

  function page_reload()
  {
    $.ajax({
      type: "HEAD",
      url: window.location,
      success: function() {
        window.location.reload();
      },
      error: function() {
        console.log("error reloading page.");
        setTimeout(page_reload, 60000);
      },
      statusCode: {
        404: function() { console.log("404"); },
        501: function() { console.log("501"); },
        502: function() { console.log("502"); }
      }
    });
  };

  

  </script>
{% endblock %}
