{% extends "base.html" %}
{% load static i18n l10n customformatting timetracking %}

{% debug %}

{% block head %}
  {{ block.super }}
<style type="text/css">
#progress {
  -webkit-transition: none !important;
  transition: none !important;
}
</style>
{% endblock %}

{% block header %}
  <div style="font-size:20px; height:100%; position:relative;">
  <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation" style="margin:0px;">
    <div class="container-fluid">

      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
                aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">{% trans 'Toggle navigation' %}</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="/">Systori</a>
      </div>
      <div id="navbar" class="navbar-collapse collapse">

        <ul class="nav navbar-nav">
          <li><a href="{{ previous_day_url }}">{% trans 'back' %}</a></li>
          <li><a>{{ selected_day|date:"l" }} {{ selected_day|localize }}</a></li>
          <li><a href="{{ next_day_url }}">{% trans 'next' %}</a></li>
        </ul>
        <div class="nav navbar-text progress pull-right" style="width: 300px;">
            <div id="progress" role="progressbar" style="background-color: #d1725e; height:100%;"></div>
        </div>
      </div>
    </div>
  </nav>
{% endblock %}


{% block container %}
{% load_user_statuses %}
<div class="container-fluid">
  <div class="row equal-height-panels">
    {% for plan in selected_plans %}

      <div class="col-xs-12 col-sm-6 col-md-4 col-lg-2">
        <div class="panel {% if is_selected_past %}panel-warning{% endif %}
                         {% if is_selected_today %}panel-primary{% endif %}
                         {% if is_selected_future %}panel-info{% endif %}" data-id="{{ plan.id }}">

          <div class="panel-heading fit-text">{{ plan.jobsite.project.id }} - {{ plan.jobsite.project.name }}</div>
          <div class="panel-body">
            <h4><small>{{ plan.jobsite.name }}</small></h4>
            <h4 class="fit-text">{{ plan.jobsite.address }}</h4>
            <h4>{{ plan.jobsite.city }}</h4>
            <hr>

          {% for plan_worker in plan.workers.all %}
            <h5 class="fit-text text-info">{% show_user_status plan_worker.user %}{{ plan_worker.get_full_name }}</h5>
          {% endfor %}
            
          {% if plan.equipment.count > 0 %}
          <hr>
            {% for equipment in plan.equipment.all %}
              <h5 class="fit-text text-warning">{{ equipment|safe }}</h5>
            {% endfor %}
          {% endif %}

          {% if plan.notes %}
            <hr>
            <h4 class="fit-text text-danger">{{ plan.notes }}</h4>
          {% endif %}
          </div>
        </div>
      </div>
      {% if forloop.counter|divisibleby:6 %}
      </div> <div class="row equal-height-panels">
      {% endif %}

    {% endfor %}
  </div>
</div>

{% endblock %}
{% block extra_js %}

  {% include "main/match-height_js.html" %}
  {% include "main/fittext_js.html" %}

  <script type="text/javascript">
  
  $(document).ready(function(){
    $('.equal-height-panels .panel').matchHeight();

    jQuery(".fit-text").fitText(1.3);

    $("#progress").animate({
       width: "0%"
    }, 15000, function() {
      page_reload();
      }
    );
  
  });

  function page_reload()
  {
    $.ajax({
      type: "HEAD",
      url: window.location,
      success: function() {
        window.location.reload();
      },
      error: function() {
        console.log("error reloading page.");
        setTimeout(page_reload, 60000);
      },
      statusCode: {
        404: function() { console.log("404"); },
        501: function() { console.log("501"); },
        502: function() { console.log("502"); }
      }
    });
  };

  

  </script>
{% endblock %}
